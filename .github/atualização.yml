name: Fetch GitHub Stats

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  fetch-stats:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Fetch GitHub stats
      env:
        GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
      run: |
        curl -H "Authorization: token $GITHUB_TOKEN" \
        https://api.github.com/users/WesleyS08 \
        -o userData.json

    - name: Update index.html
      run: |
        sudo apt-get install python3
        python3 update_html.py

    - name: Update GitHub Pages
      env:
        GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
      run: |
        # Configure Git user
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        
        # Clone the GitHub Pages branch
        git clone --single-branch --branch gh-pages https://github.com/WesleyS08/my-portfolio.git gh-pages
        cd gh-pages

        # Ensure data directory exists
        mkdir -p data

        # Update the stats file
        cp ../userData.json data/userData.json

        # Commit and push changes
        git add data/userData.json index.html
        git commit -m 'Update GitHub stats and index.html'
        git push origin gh-pages
